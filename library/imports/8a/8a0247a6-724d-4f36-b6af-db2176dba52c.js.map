{"version":3,"sources":["../../../../../assets/script/component/assets/script/component/JoyStickCmp.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../assets/script/component","sourcesContent":["/**\n * 游戏摇杆\n */\n\nimport BaseComponent from \"../core/BaseComponent\"\nimport { log, errlog } from \"../core/helper/LogHelper\";\n\nconst { ccclass, property } = cc._decorator\n\nenum TouchType {\n    DEFAULT = 0,\n    FOLLOW =  1\n}\n\nenum DirectionType {\n    FOUR = 0,\n    EIGHT = 1,\n    ALL = 2\n}\n\nexport enum Dir {\n    Center = null, // 无方向\n    Up = 90, // 上\n    Down = 270, // 下\n    Left = 180, // 左\n    Right = 0, // 右\n    LeftUp = 135, // 左上\n    LeftDown = 225, // 左下\n    RightUp = 45, // 右上\n    RightDown = 315 // 右下 \n}\n\n@ccclass\nexport default abstract class JoyStickCmp extends BaseComponent {\n\n    // 控制杆\n    @property(cc.Node)\n    private stickBar: cc.Node = null\n\n    // 控制杆背景\n    @property(cc.Node)\n    private stickBg: cc.Node = null\n\n    // 半径\n    @property(cc.Float)\n    private radius: number = 0\n\n    // 操作类型\n    @property({type: cc.Enum(TouchType)})\n    private touchType: TouchType = TouchType.DEFAULT\n\n    // 方向类型\n    @property({type: cc.Enum(DirectionType)})\n    private directionType: DirectionType = DirectionType.ALL\n\n    // 半径\n    @property(cc.Integer)\n    private defaultOpacity: number = 200\n\n    //触控区域\n    @property(cc.Node)\n    private touchArea: cc.Node = null\n\n    //当前角度\n    private curAngle: number = 0\n\n    //当前距离\n    private distance: number = 0\n\n    // 操作阈值(敏感度)\n    private threshold: number = 10\n\n    // 触发事件标志\n    private isTrigger: boolean = false\n\n    // 初始位置\n    private initPos: cc.Vec2 \n\n    // 角度改变回调\n    private changeCallback\n\n    public onLoad() {\n        this.node.opacity = this.defaultOpacity\n        this.initPos = this.node.position\n        if (this.radius === 0) {\n            this.radius = this.stickBg.width * this.stickBg.scale / 2\n        }\n        if (!this.touchArea) {\n            const canvas = cc.find('Canvas')\n            if (canvas) {\n                // 如果没有设置触控区域,优先使用canvas节点5\n                this.touchArea = canvas\n            } else {\n                // 如果没有设置触控区域,那么默认触控区域2000\n                this.touchArea = new cc.Node()\n                this.touchArea.parent = this.node.parent\n                this.touchArea.setContentSize(2000, 2000)\n            }\n        }\n        this.registerTouch()\n    }\n\n    public setChangeListener(callback) {\n        this.changeCallback = callback\n    }\n\n    private registerTouch() {\n        this.touchArea.on(cc.Node.EventType.TOUCH_START, (event) => {\n            this.onTouchStart(event)\n        }, this)\n\n        this.touchArea.on(cc.Node.EventType.TOUCH_MOVE, (event) => {\n            this.onTouchMove(event)\n        }, this)\n\n        this.touchArea.on(cc.Node.EventType.TOUCH_END, (event) => {\n            this.onTouchEnd(event)\n        }, this)\n\n        this.touchArea.on(cc.Node.EventType.TOUCH_CANCEL, (event) => {\n            this.onTouchCancel(event)\n        }, this)\n    }\n\n    private onTouchStart(event: cc.Event.EventTouch) {\n        //如果触摸类型为FOLLOW，则摇控杆的位置为触摸位置,触摸开始时候现形\n        if (this.touchType == TouchType.FOLLOW) {\n            const touchPos = this.node.parent.convertToNodeSpaceAR(event.touch.getLocation())\n            this.node.setPosition(touchPos)\n            this.isTrigger = true\n            return\n        } else {\n            // 把触摸点坐标转换为相对与目标的模型坐标\n            const touchPos = this.node.convertToNodeSpaceAR(event.touch.getLocation())\n            //点与圆心的距离\n            const distance = touchPos.sub(cc.v2(0, 0)).mag()\n            //如果点与圆心距离小于圆的半径,且大于操作阈值,触控成功\n            if (distance < this.radius && distance > this.threshold) {\n                this.node.opacity = 255\n                this.stickBar.setPosition(touchPos)\n                this.updateAngle(touchPos)\n                this.isTrigger = true\n                return\n            }\n        }\n        this.isTrigger = false\n    }\n\n\n    private onTouchMove(event: cc.Event.EventTouch) {\n        if (!this.isTrigger) {\n            return\n        }\n        const touchPos = this.node.convertToNodeSpaceAR(event.touch.getLocation())\n        const distance = touchPos.sub(cc.v2(0, 0)).mag()\n        if (this.radius >= distance) {\n            //如果点与圆心距离小于圆的半径,控杆跟随触摸点\n            if(distance > this.threshold){\n                this.node.opacity = 255\n                this.stickBar.setPosition(touchPos)\n                // 更新角度\n                this.updateAngle(touchPos)\n            }else {\n                this.node.opacity = this.defaultOpacity\n                // 摇杆恢复位置\n                this.stickBar.setPosition(cc.v2(0,0))\n                this.curAngle = null\n                // 通知角度变化回调\n                this.emitAngle(this.curAngle)\n            }\n        } else {\n            const x = Math.cos(this.calcuRadian(touchPos)) * this.radius\n            let y = Math.sin(this.calcuRadian(touchPos)) * this.radius\n            if(touchPos.y < 0){\n                // 在三四象限的时候,y要调整\n                y *= -1;\n            }\n            this.stickBar.setPosition(cc.v2(x, y))\n            this.updateAngle(touchPos)\n        }\n    }\n\n    private onTouchEnd(event: cc.Event.EventTouch) {\n        if (!this.isTrigger) {\n            return\n        }\n        this.isTrigger = false\n        this.resetStick()\n    }\n\n    private onTouchCancel(event: cc.Event.EventTouch) {\n        this.resetStick()\n    }\n\n    // 更新方向\n    private updateAngle(point) {\n        this.curAngle = Math.floor(this.calcuRadian(point) * 180 / Math.PI)\n\n        if(point.x>0 && point.y<0 || point.x<0 && point.y<0) {\n            this.curAngle = 360 - this.curAngle\n\n        }else if(point.x<0 && point.y==0) {\n            this.curAngle = 180\n\n        }else if(point.x>0 && point.y==0) {\n            this.curAngle = 0\n\n        }else if(point.x==0 && point.y>0){\n            this.curAngle = 90\n\n        }else if(point.x==0 && point.y<0){\n            this.curAngle = 270\n        }\n        this.formatAngle()\n    }\n\n    private formatAngle() {\n        switch (this.directionType)\n        {\n            case DirectionType.FOUR:\n                this.curAngle = this.fourDirections()\n                break\n\n            case DirectionType.EIGHT:\n                this.curAngle = this.eightDirections()\n                break\n\n            case DirectionType.ALL:\n                this.curAngle = this.curAngle\n                break\n\n            default :\n                this.curAngle = null\n                break\n        }\n        this.emitAngle(this.curAngle)\n    }\n\n    // 格式化方向(四方向)\n    private fourDirections() {\n        if(this.curAngle >= 45 && this.curAngle <= 135) {\n            return Dir.Up\n\n        } else if(this.curAngle >= 225 && this.curAngle <= 315) {\n            return Dir.Down\n\n        } else if(this.curAngle <= 225 && this.curAngle >= 180 || this.curAngle >= 135 && this.curAngle <= 180) {\n            return Dir.Left\n\n        } else if(this.curAngle <= 360 && this.curAngle >= 315 || this.curAngle >= 0 && this.curAngle <= 45) {\n            return Dir.Right\n\n        }\n    }\n\n    // 格式化方向(四方向)\n    private eightDirections() {\n        if(this.curAngle >= 67.5 && this.curAngle <= 112.5) {\n            return Dir.Up\n\n        } else if(this.curAngle >= 247.5 && this.curAngle <= 292.5) {\n            return Dir.Down\n\n        } else if(this.curAngle <= 202.5 && this.curAngle >= 180 || this.curAngle >= 157.5 && this.curAngle <= 180) {\n            return Dir.Left\n\n        } else if(this.curAngle <= 360 && this.curAngle >= 337.5 || this.curAngle >= 0 && this.curAngle <= 22.5) {\n            return Dir.Right\n\n        } else if(this.curAngle >= 112.5 && this.curAngle <= 157.5) {\n            return Dir.LeftUp\n            \n        } else if(this.curAngle >= 22.5 && this.curAngle <= 67.5) {\n            return Dir.RightUp\n            \n        } else if(this.curAngle >= 202.5 && this.curAngle <= 247.5) {\n            return Dir.LeftDown\n            \n        } else if(this.curAngle >= 292.5 && this.curAngle <= 337.5) {\n            return Dir.RightDown\n            \n        }\n    }\n\n    // 推送更新方向通知\n    private emitAngle(angle) {\n        if (this.changeCallback) {\n            try {\n                this.changeCallback(angle)\n            } catch (error) {\n                errlog(error)\n            }\n        }\n    }\n\n    private resetStick() {\n        this.node.opacity = this.defaultOpacity\n        //如果触摸类型为FOLLOW，离开触摸后隐藏\n        if(this.touchType == TouchType.FOLLOW){\n            this.node.position = this.initPos\n        }\n        this.stickBar.setPosition(cc.v2(0,0))\n        this.curAngle = null\n        this.emitAngle(this.curAngle)\n    }\n\n    // 计算弧度\n    private calcuRadian(point) {\n        const z = Math.sqrt(Math.pow(point.x,2)+Math.pow(point.y,2))\n        if (z === 0) {\n            return 0\n        } else {\n            return Math.acos(point.x/z)\n        }\n    }\n\n    public onDestroy() {\n        this.changeCallback = null\n    }\n\n\n}"]}