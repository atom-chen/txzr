{"version":3,"sources":["StorageHelper.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../../assets/script/core/helper","sourcesContent":["/**\n * Stroage存储\n */\n\nexport default class StorageHelper {\n    private static _instance: StorageHelper\n    // 是否是微信环境下\n    private static _isWx: boolean\n\n    // 获取单例\n    public static get Ins(): StorageHelper {\n        try {\n            wx.getStorageSync(\"wx\")\n            StorageHelper._isWx = true\n        } catch (e) {\n            StorageHelper._isWx = false\n        }\n        return StorageHelper._instance || (StorageHelper._instance = new StorageHelper())\n    }\n\n    /**\n     * 设置键值\n     */\n    public setItem(key: string, val) {\n        if (StorageHelper._isWx) {\n            // 判断如果存在wx上下文\n            wx.setStorageSync({key, data: val})\n        } else {\n            cc.sys.localStorage.setItem(key, val)\n        }\n    }\n\n    /**\n     * 获取键值\n     */\n    public getItem(key: string) {\n        if (StorageHelper._isWx) {\n            const data = wx.getStorageSync({key})\n            return data\n        } catch (e) {\n            const data = cc.sys.localStorage.getItem(key)\n            return data\n        }\n    }\n\n    /**\n     * 清空存储数据\n     */\n    public clear() {\n        if (StorageHelper._isWx) {\n            wx.clearStorageSync({})\n        } else {\n            cc.sys.localStorage.clear()\n        }\n    }\n    \n    /**\n     * 设置键值(异步) \n     */\n    public setItemAsync(key: string, val): Promise<any> {\n        return new Promise((resolve, reject) => {\n            if (StorageHelper._isWx) {\n                // 判断如果存在wx上下文\n                wx.setStorage({\n                    key,\n                    data: val,\n                    success: () => resolve(),\n                    fail: e => reject(e.errMsg)\n                })\n            } else {\n                cc.sys.localStorage.setItem(key, val)\n                resolve()\n            }\n        })\n    }\n\n    /**\n     * 获取键值(异步)\n     */\n    public getItemAsync(key: string): Promise<any> {\n        return new Promise((resolve, reject) => {\n            if (StorageHelper._isWx) {\n                wx.getStorage({\n                    key,\n                    success: res => {\n                        if (res && res.errMsg.test(/ok/)) {\n                            resolve(res.data)\n                        } else if (res.errMsg.test(/fail data not found/)) {\n                            resolve(undefined)\n                        } else {\n                            reject(res.errMsg)\n                        }\n                    },\n                    fail: res => reject(res.errMsg)\n                })\n            } else {\n                const data = cc.sys.localStorage.getItem(key)\n                resolve(data)\n            }\n        })\n    }\n\n    /**\n     * 清空存储数据(异步)\n     */\n    public static clearAsync(): Promise<any> {\n        return new Promise((resolve, reject) => {\n            if (StorageHelper._isWx) {\n                wx.clearStorage({\n                    success: data => resolve(data.errMsg),\n                    fail: e => reject(e.errMsg)\n                })\n            } else {\n                cc.sys.localStorage.clear()\n                resolve()\n            }\n        })\n    }\n} \n\n"]}