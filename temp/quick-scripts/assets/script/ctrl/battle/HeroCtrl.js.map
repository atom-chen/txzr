{"version":3,"sources":["HeroCtrl.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../../assets/script/ctrl/battle","sourcesContent":["/**\n * 英雄控制\n */\nimport BaseCtrl from \"../../core/BaseCtrl\"\nimport { autoBind } from \"../../core/decorator/AutoBind\"\nimport { log } from \"../../core/helper/LogHelper\";\nimport { changeAngle } from \"../../core/helper/3DHelper\";\nconst {ccclass, property} = cc._decorator\n\nexport enum HeroState {\n    Idle = 0,\n    Run = 1,\n    Attack = 2,\n}\nconst attackTime = 60\n\n@ccclass\nexport default class HeroCtrl extends BaseCtrl {\n    private speed: number = 300\n    private offset: cc.Vec2 = cc.v2(0, 0)\n    private curState: HeroState = HeroState.Idle\n\n    @autoBind(cc.SkeletonAnimation)\n    private stoneKing: cc.SkeletonAnimation\n\n    @autoBind(cc.Sprite)\n    private clockSprite: cc.Sprite\n\n    @autoBind(cc.Label)\n    private nameLabel: cc.Label\n\n    public onLoad() {\n        this.clockAction()\n    }\n\n    public clockAction() {\n        this.clockSprite.node.runAction(cc.repeatForever(\n            cc.sequence(\n                cc.scaleTo(0.5, 1.2),\n                cc.scaleTo(0.5, 1)\n            )\n        ))\n    }\n\n    public heroMove(angle) {\n        if (angle === null) {\n            this.offset = cc.v2(0, 0)\n            return\n        }\n\n        const angelvec4 = changeAngle(Math.PI / 180 * (angle + 90), 0, Math.PI / 180 * 90)\n        this.stoneKing.node.setRotation(angelvec4.qw, angelvec4.qx, angelvec4.qy, angelvec4.qz)\n\n        if (angle === 0 || angle === 180 || angle === 90) {\n            this.offset = cc.v2(Math.floor(Math.cos(Math.PI / 180 * angle)), Math.floor(Math.sin(Math.PI / 180 * angle)))\n\n        } else if (angle === 270) {\n            this.offset = cc.v2(Math.ceil(Math.cos(Math.PI / 180 * angle)), Math.floor(Math.sin(Math.PI / 180 * angle)))\n\n        } else {\n            this.offset = cc.v2(Math.cos(Math.PI / 180 * angle), Math.sin(Math.PI / 180 * angle));\n        }\n    }\n \n    public update(dt) {\n        let interpolation = 1\n        if (this.curState !== HeroState.Attack) {\n            if (this.offset.x === 0 && this.offset.y === 0) {\n                this.idle()\n            } else {\n                this.run()\n            }\n        } else {\n            interpolation = 0.05\n        }\n\n        const nextX = this.node.x + this.offset.x * this.speed * dt * interpolation\n        const nextY = this.node.y + this.offset.y * this.speed * dt * interpolation\n        this.node.setPosition(nextX, nextY)\n    }\n\n    /**\n     * 攻击\n     */\n    public attack(type) {\n        if (this.curState === HeroState.Attack) {\n            return\n        }\n        this.curState = HeroState.Attack\n        // if (type === 1) {\n        //     this.spine.animation = `punch1`\n        // } else {\n        //     this.spine.animation = `meleeSwing1`\n        // }\n        \n        // this.spine.loop = false\n        this.scheduleOnce(() => {\n            this.idle()\n        }, 0.2)\n    }\n\n    /**\n     * 休息\n     */\n    public idle() {\n        if (this.curState === HeroState.Idle) {\n            return\n        }\n        this.curState = HeroState.Idle\n       // this.spine.animation = 'idle'\n        // this.spine.loop = true\n    }\n\n    /**\n     * 跑\n     */\n    public run() {\n        if (this.curState === HeroState.Run) {\n            return\n        }\n        this.curState = HeroState.Run\n        // this.spine.animation = 'run'\n        // this.spine.loop = true\n    }\n \n}"]}